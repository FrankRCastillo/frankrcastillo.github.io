<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
    <html lang="en">
        <style>
            body  {font-size: 11px; font-family: "Lucida Console", Monaco, monospace; }
            td { vertical-align: top; }
        </style>
        <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
        <script src="https://unpkg.com/mathjs@5.0.4/dist/math.min.js"></script>
        <script>
            document.body = document.createElement("body");

            let grid = new Array(81);
            for (i = 0; i < grid.length; i++) {
                    grid[i] = new Array(9);
                    for (j = 0; j < grid[i].length; j++) {
                        grid[i][j] = j + 1;
                    }
            }
            

            let game = [6,0,0,0,9,0,0,0,2
                       ,0,8,0,6,1,0,0,9,0
                       ,0,0,7,8,0,0,5,0,0
                       ,0,0,0,0,0,0,6,7,0
                       ,8,2,0,0,0,0,0,3,9
                       ,0,7,6,0,0,0,0,0,0
                       ,0,0,2,0,0,1,4,0,0
                       ,0,3,0,0,2,6,0,5,0
                       ,9,0,0,0,7,0,0,0,1];
 /*
            let game = [8,0,0,0,0,0,0,0,0
                       ,0,0,3,6,0,0,0,0,0
                       ,0,7,0,0,9,0,2,0,0
                       ,0,5,0,0,0,7,0,0,0
                       ,0,0,0,0,4,5,7,0,0
                       ,0,0,0,1,0,0,0,3,0
                       ,0,0,1,0,0,0,0,6,8
                       ,0,0,8,5,0,0,0,1,0
                       ,0,9,0,0,0,0,4,0,0];
*/


            let gArr = [game, grid, false];
            let gameAns = fuzzySolve(gArr);
            
            function fuzzySolve(r) {
                r = elimSolve(r);             
                let cx = JSON.parse(JSON.stringify(r[0]));
                let cg = copyGrid(r[1]);
                
                //REWORK!!!
                
            }

            function elimSolve(r) {
                let x  = r[0];
                let g  = r[1];
                let sl = r[2];
                let oG;
                let nG = x.toString();
                let change = true;
                while (change) {
                    for (i = 0; i < x.length; i++) {
                        //Occupied cell elimination
                        if (x[i] != 0) g[i].length = 0;

                        //Horizontal elimination
                        for (let j = 0; j < 9; j++) {
                            for (let n = 0; n <= 72; n += 9) {
                                if (i >= n && i <= (n + 8)) {
                                    for (let k = 0; k < 9; k++) {
                                        if (x[i] == g[j + n][k]) g[j + n].splice(k, 1);
                                    }
                                }
                            }
                        }
                        
                        //Vertical elimination
                        for (let n = i % 9; n <= (i % 9) + 72; n += 9) {
                            for (let k = 0; k < 9; k++) {
                                if(x[i] == g[n][k]) g[n].splice(k, 1);
                            }
                        }

                        //Square elimination
                        for (let j = 0; j <= 80; j += 27) {
                            if (i >= j && i <= (j + 26)) {
                                for (let k = 0; k <= 9; k += 3) {
                                    if (i % 9 >= k && i % 9 <= (k + 2)) {
                                        for (let s = 0; s <= 2; s++) {
                                            for (let t = 0; t <= 18; t += 9) {
                                                let sqr = j + k + s + t;
                                                for (let u = 0; u < 9; u++) {
                                                    if (x[i] == g[sqr][u]) g[sqr].splice(u, 1);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                       
                        /* If a candidate array containing only one candidate solution
                           exists, that is the only possible entry that can be in the game
                           and, therefore, is entered in the game */
                        let j = g.length;
                        for (k = 0; k < j; k++) {
                            if(g[k].length == 1) x[k] = g[k][0];
                        }
                    }
                    /* If, after elimination, the loop completes without changing
                       the game, then the while loop ends, returning the object. */
                    if (oG == nG) change = false;
                    oG = nG.toString();
                }
                sl = solvedGame(x);
                return r;
            }

            //Copies 2D array. Iterative implementation of JSON parse solution
            function copyGrid(r) {
                let nr = new Array(r.length);
                for (i in r) {
                    nr[i] = JSON.parse(JSON.stringify(r[i]));
                }
                return nr;
            }

            function validGame(r) {
                //Row verification
                for (let i = 0; i < r.length; i += 9) {
                    for (j = 0; j < 9; j++) {
                        if (r[i] == r[i + j]
                        &&  r[i] != 0
                        &&  r[i + j] != 0
                        &&  i != (i + j)) return false;
                    }
                }
                
                //Column verification
                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < r.length; j += 9) {
                        if (r[i] == r[i + j]
                        &&  r[i] != 0
                        &&  r[i + j] != 0
                        &&  i != (i + j)) return false;
                    }
                }
                
                //Square verification
                for (i = 0; i < r.length; i++) {
                    for (let j = 0; j <= 80; j += 27) {
                        if (i >= j && i <= (j + 26)) {
                            for (let k = 0; k <= 9; k += 3) {
                                if (i % 9 >= k && i % 9 <= (k + 2)) {
                                    for (let s = 0; s <= 2; s++) {
                                        for (let t = 0; t <= 18; t += 9) {
                                            if (r[i] == r[j + k + s + t]
                                            &&  r[i] != 0
                                            &&  r[j + k + s + t] != 0
                                            &&  i != (j + k + s + t)) return false;
                                        }
                                    }
                                }
                            }
                        }

                    }
                }
                return true; 
            }
            
            function solvedGame(r) {
                    //Row verification
                    let rowSum = 0;
                    for (let i = 0; i < r.length; i += 9) {
                        for (j = 0; j < 9; j++) {
                            rowSum += r[i + j];
                        }
                        if (rowSum != 45) return false;
                        rowSum = 0;
                    }
                    
                    //Column verification
                    let colSum = 0;
                    for (let i = 0; i < 9; i++) {
                        for (let j = 0; j < r.length; j += 9) {
                            colSum += r[i + j];
                        }
                        if (colSum != 45) return false;
                        colSum = 0;
                    }
                    
                    //Square verification
                    let sqrSum = 0;
                    for (i = 0; i < r.length; i++) {
                        for (let j = 0; j <= 80; j += 27) {
                            if (i >= j && i <= (j + 26)) {
                                for (let k = 0; k <= 9; k += 3) {
                                    if (i % 9 >= k && i % 9 <= (k + 2)) {
                                        for (let s = 0; s <= 2; s++) {
                                            for (let t = 0; t <= 18; t += 9) {
                                                sqrSum += r[j + k + s + t];
                                            }
                                        }
                                        if (sqrSum != 45) return false
                                        sqrSum = 0;
                                    }
                                }
                            }

                        }
                    }
                return true;
            }
        </script>
</html>
