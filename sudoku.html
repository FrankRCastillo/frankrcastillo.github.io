<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
    <html lang="en">
        <style>
            body  {font-size: 11px; font-family: "Lucida Console", Monaco, monospace; }
            td { vertical-align: top; }
        </style>
        <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
        <script>
            document.body = document.createElement("body");

            let grid = new Array(81);
            for (i = 0; i < grid.length; i++) {
                    grid[i] = new Array(9);
                    for (j = 0; j < grid[i].length; j++) {
                        grid[i][j] = j + 1;
                    }
            }
            let game = [6,0,0,0,9,0,0,0,2
                       ,0,8,0,6,1,0,0,9,0
                       ,0,0,7,8,0,0,5,0,0
                       ,0,0,0,0,0,0,6,7,0
                       ,8,2,0,0,0,0,0,3,9
                       ,0,7,6,0,0,0,0,0,0
                       ,0,0,2,0,0,1,4,0,0
                       ,0,3,0,0,2,6,0,5,0
                       ,9,0,0,0,7,0,0,0,1];
/*            
            let game = [8,0,0,0,0,0,0,0,0
                       ,0,0,3,6,0,0,0,0,0
                       ,0,7,0,0,9,0,2,0,0
                       ,0,5,0,0,0,7,0,0,0
                       ,0,0,0,0,4,5,7,0,0
                       ,0,0,0,1,0,0,0,3,0
                       ,0,0,1,0,0,0,0,6,8
                       ,0,0,8,5,0,0,0,1,0
                       ,0,9,0,0,0,0,4,0,0];
*/
            let gArr = [game, grid];

            $("body").append(printGrid(gArr));
            $("body").append(printGrid(fuzzySolve(gArr)));

            function fuzzySolve(r) {
                let x  = r[0];
                let g  = r[1];
                
                r = elimSolve(r);
                
                let cx = JSON.parse(JSON.stringify(x));
                let cg = copyGrid(g);
                let lgth = [];
                for (let i = 0; i < x.length; i++) {
                    if (g[i].length == 0) g[i] = [x[i]];
                    x[i] = [x[i]];
                    lgth.push([x[i].length, i]);                    
                }
                
                lgth.sort((a, b) => a[0] - b[0]);
                
                let prod = lgth.reduce((a, b) => a * b);
                let div = [];
                for (let i = cg.length -1; i >= 0; i--) {
                    div[i] = div[i + 1] ? div[i + 1] * cg[i + 1].length : 1;
                }
                
                for (let i = 0; i < prod; i++) {
                    let nx = permut(i, cg);
                    console.log(nx.toString());
                }
                
                function permut(n, arr) {
                    var result = [];
                    for (var i = 0; i < arr.length; i++) {
                        result.push(arr[i][Math.floor(n/div[i]) % arr[i].length]);
                    }
                    return result;
                }
            }
            
            function elimSolve(r) {
                let x  = r[0];
                let g  = r[1];
                let sl = false;
                let oG;
                let nG = x.toString();
                let change = true;
                while (change) {
                    for (i = 0; i < x.length; i++) {
                        //Occupied cell elimination
                        if (x[i] != 0) g[i].length = 0;

                        //Horizontal elimination
                        for (let j = 0; j < 9; j++) {
                            for (let n = 0; n <= 72; n += 9) {
                                if (i >= n && i <= (n + 8)) {
                                    for (let k = 0; k < 9; k++) {
                                        if (x[i] == g[j + n][k]) g[j + n].splice(k, 1);
                                    }
                                }
                            }
                        }
                        
                        //Vertical elimination
                        for (let n = i % 9; n <= (i % 9) + 72; n += 9) {
                            for (let k = 0; k < 9; k++) {
                                if(x[i] == g[n][k]) g[n].splice(k, 1);
                            }
                        }

                        //Square elimination
                        for (let j = 0; j <= 80; j += 27) {
                            if (i >= j && i <= (j + 26)) {
                                for (let k = 0; k <= 9; k += 3) {
                                    if (i % 9 >= k && i % 9 <= (k + 2)) {
                                        for (let s = 0; s <= 2; s++) {
                                            for (let t = 0; t <= 18; t += 9) {
                                                let sqr = j + k + s + t;
                                                for (let u = 0; u < 9; u++) {
                                                    if (x[i] == g[sqr][u]) g[sqr].splice(u, 1);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                       
                        /* If a candidate array containing only one candidate solution
                           exists, that is the only possible entry that can be in the game
                           and, therefore, is entered in the game */
                        let j = g.length;
                        for (k = 0; k < j; k++) {
                            if(g[k].length == 1) x[k] = g[k][0];
                        }
                    }
                    /* If, after elimination, the loop completes without changing
                       the game, then the while loop ends, returning the object. */
                    if (oG == nG) change = false;
                    oG = nG.toString();
                }
                return [x, g];
            }

            /* Returns Sudoku games and corresponding grid of candidates as an HTML
               table. If there is a zero/blank space, it'll be highlighted in red. */
            function printGrid(r) {
                let x = r[0];
                let g = r[1];
                let output = "<table><tr><td><table>";
                let q = 0;
                let digit = "";
                
                //Creates HTML code for 9x9 HTML table of game
                for (i = 0; i < 9; i++) {
                    output += "<tr>";
                    for (j = 0; j < 9; j++) {
                        if (x[q] == 0) {
                            digit = "<font color='red'>" + x[q] + "</font>";
                        } else {
                            digit = x[q];
                        }
                        output += "<td>" + digit + "</td>";
                        q++;
                    }
                    output += "</tr>";
                }
                output += "</table><br/></td><td><table><tr>";
                
                //Creates HTML code for row for elements in game
                let p = 1;
                for (i = 0; i < x.length; i++) {
                    if (x[i] == 0) {
                        digit = "<font color='red'>" + x[i] + "</font>";
                    } else {
                        digit = x[i];
                    }
                    output += "<td>" + digit + "<br/>-<br/>" + p + "<br/>-<br/>" + g[i].length + "<br/>-<br/></td>";
                    if (p == 9) { p = 1; } else { p++; }
                }
                output += "</tr><tr>";
                
                //Creates HTML code for row for possible candidates
                for (i = 0; i < g.length; i++) {
                    output += "<td>";
                    for (j = 0; j < g[i].length; j++) {
                        output += g[i][j] + "<br/>";
                    }
                    output += "</td>"
                }
                output += "</tr></table></td></tr></table>";
                return output;
            }

            //Copies 2D array. Iterative implementation of JSON parse solution
            function copyGrid(r) {
                let nr = new Array(r.length);
                for (i in r) {
                    nr[i] = JSON.parse(JSON.stringify(r[i]));
                }
                return nr;
            }
            
            function verify(r) {
                let pass = true;
                for (m = 0; m < r.length; m++) {
                    //Row verification
                    for (let i = 0; i < r[0].length; i += 9) {
                        for (j = 0; j < 9; j++) {
                            let e = r[i + j];
                            if (v == e && e != 0) return false;
                        }
                    }
                    
                    //Column verification
                    for (let i = 0; i < 9; i++) {
                        for (let j = 0; j < r[0].length; j += 9) {
                            let e = r[i + j];
                            if (v == e && e != 0) return false;
                        }
                    }
                    
                    //Square verification
                    for (let j = 0; j <= 80; j += 27) {
                        if (i >= j && i <= (j + 26)) {
                            for (let k = 0; k <= 9; k += 3) {
                                if (i % 9 >= k && i % 9 <= (k + 2)) {
                                    for (let s = 0; s <= 2; s++) {
                                        for (let t = 0; t <= 18; t += 9) {
                                            let e = r[0][j + k + s + t];
                                            if(v == e && e != 0) return false;
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                if (pass) return true;
            }
        </script>
</html>
